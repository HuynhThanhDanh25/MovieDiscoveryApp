<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Discovery App - Huỳnh Thanh Danh (231A010145) - EG04</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Toàn bộ CSS được viết trực tiếp trong style tag -->
    <style>
        /* === CSS Variables === */
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #e63946;
            --background-color: #f8f9fa;
            --surface-color: #ffffff;
            --text-color: #333333;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --hover-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            --card-radius: 12px;
            --transition: all 0.3s ease;
        }
        .dark-mode {
            --primary-color: #64b5f6;
            --secondary-color: #42a5f5;
            --accent-color: #ff6b6b;
            --background-color: #121212;
            --surface-color: #1e1e1e;
            --text-color: #e0e0e0;
            --text-secondary: #b0b0b0;
            --border-color: #333333;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            --hover-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
        }
        /* === Reset & Base Styles === */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            transition: var(--transition);
            line-height: 1.6;
            min-height: 100vh;
        }
        .container { width: 100%; max-width: 1400px; margin: 0 auto; padding: 0 20px; }
        /* === Header === */
        header {
            background-color: var(--surface-color);
            box-shadow: var(--shadow);
            position: sticky; top: 0; z-index: 100;
        }
        .header-container {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px;
        }
        .logo {
            display: flex; align-items: center; gap: 15px;
        }
        .logo i { font-size: 2rem; color: var(--primary-color); }
        .logo h1 {
            font-size: 1.8rem;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text; background-clip: text; color: transparent;
        }
        /* === Theme Toggle === */
        .theme-toggle { display: flex; align-items: center; gap: 10px; }
        .switch {
            position: relative; display: inline-block; width: 60px; height: 30px;
        }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute; cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc; transition: .4s; border-radius: 34px;
        }
        .slider:before {
            position: absolute; content: "";
            height: 22px; width: 22px; left: 4px; bottom: 4px;
            background-color: white; transition: .4s; border-radius: 50%;
        }
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(30px); }
        /* === Main Layout (CSS Grid) === */
        .main-container {
            display: grid; grid-template-columns: 300px 1fr; gap: 30px;
            padding: 30px 20px; min-height: calc(100vh - 160px);
        }
        /* === Sidebar === */
        .sidebar {
            background-color: var(--surface-color); border-radius: var(--card-radius);
            padding: 25px; box-shadow: var(--shadow); height: fit-content;
            position: sticky; top: 100px;
        }
        .search-box { position: relative; margin-bottom: 25px; }
        .search-box i {
            position: absolute; left: 15px; top: 50%;
            transform: translateY(-50%); color: var(--text-secondary); z-index: 1;
        }
        .search-box input {
            width: 100%; padding: 12px 15px 12px 45px;
            border: 2px solid var(--border-color); border-radius: 8px;
            font-size: 1rem; background-color: var(--surface-color);
            color: var(--text-color); transition: var(--transition);
        }
        .search-box input:focus {
            outline: none; border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
        }
        /* === Genre Filters === */
        .filters h3, .stats h3 {
            margin-bottom: 15px; color: var(--primary-color);
            display: flex; align-items: center; gap: 10px; font-size: 1.1rem;
        }
        .filter-options {
            display: flex; flex-direction: column; gap: 12px;
            max-height: 300px; overflow-y: auto; padding-right: 5px;
        }
        .filter-options::-webkit-scrollbar { width: 6px; }
        .filter-options::-webkit-scrollbar-track { background: var(--background-color); border-radius: 3px; }
        .filter-options::-webkit-scrollbar-thumb { background: var(--primary-color); border-radius: 3px; }
        .genre-option {
            display: flex; align-items: center; gap: 10px;
            padding: 8px 0; cursor: pointer;
        }
        .genre-option:hover { background-color: var(--background-color); border-radius: 4px; padding-left: 5px; }
        .genre-option input { width: 18px; height: 18px; accent-color: var(--primary-color); cursor: pointer; }
        .genre-option label { cursor: pointer; flex-grow: 1; user-select: none; }
        .genre-count {
            background-color: var(--primary-color); color: white;
            padding: 2px 8px; border-radius: 10px; font-size: 0.8rem;
            min-width: 25px; text-align: center;
        }
        /* === Stats & Info === */
        .stats { margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border-color); }
        .stats p { margin: 8px 0; display: flex; justify-content: space-between; align-items: center; }
        .student-info {
            margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border-color);
            background-color: rgba(74, 111, 165, 0.05); padding: 15px; border-radius: 8px;
        }
        .student-info h3 { color: var(--secondary-color); }
        .btn-clear {
            width: 100%; padding: 10px; background-color: var(--accent-color);
            color: white; border: none; border-radius: 8px; cursor: pointer;
            font-size: 0.95rem; display: flex; align-items: center;
            justify-content: center; gap: 8px; transition: var(--transition);
        }
        .btn-clear:hover { background-color: #d62839; transform: translateY(-2px); box-shadow: var(--shadow); }
        /* === Main Content & Movie Grid === */
        .main-content { padding: 10px; }
        .movies-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px; min-height: 400px;
        }
        /* === Movie Card === */
        .movie-card {
            background-color: var(--surface-color); border-radius: var(--card-radius);
            overflow: hidden; box-shadow: var(--shadow); transition: var(--transition);
            cursor: pointer; height: 100%; display: flex; flex-direction: column;
        }
        .movie-card:hover { transform: translateY(-10px); box-shadow: var(--hover-shadow); }
        .movie-poster {
            width: 100%; height: 350px; object-fit: cover;
            border-bottom: 3px solid var(--primary-color);
        }
        .movie-info { padding: 20px; flex: 1; display: flex; flex-direction: column; }
        .movie-title {
            font-size: 1.2rem; font-weight: 600; margin-bottom: 8px;
            color: var(--text-color); display: -webkit-box;
            -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
            min-height: 2.8em;
        }
        .movie-rating {
            position: absolute; top: 15px; right: 15px;
            background-color: rgba(0, 0, 0, 0.7); color: white;
            padding: 5px 10px; border-radius: 20px; font-size: 0.9rem; font-weight: 600;
        }
        .movie-genres { display: flex; flex-wrap: wrap; gap: 5px; margin-top: auto; }
        .genre-tag {
            background-color: var(--primary-color); color: white;
            padding: 3px 8px; border-radius: 4px; font-size: 0.75rem; opacity: 0.9;
        }
        /* === Modal === */
        .modal {
            display: none; position: fixed; top: 0; left: 0;
            width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000; overflow-y: auto; padding: 20px;
        }
        .modal-content {
            background-color: var(--surface-color); max-width: 800px;
            margin: 50px auto; border-radius: var(--card-radius);
            overflow: hidden; box-shadow: var(--shadow); position: relative;
            animation: modalFadeIn 0.3s ease;
        }
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .close-modal {
            position: absolute; top: 15px; right: 15px; background: none;
            border: none; font-size: 2rem; color: var(--text-color);
            cursor: pointer; z-index: 10; width: 40px; height: 40px;
            border-radius: 50%; display: flex; align-items: center;
            justify-content: center; background-color: rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }
        .close-modal:hover { background-color: rgba(0, 0, 0, 0.2); transform: rotate(90deg); }
        .modal-body { padding: 40px; }
        .movie-detail { display: grid; grid-template-columns: 300px 1fr; gap: 30px; }
        /* === Footer === */
        footer {
            background-color: var(--surface-color); padding: 20px;
            text-align: center; border-top: 1px solid var(--border-color);
            margin-top: 30px;
        }
        footer p { margin: 5px 0; color: var(--text-secondary); }
        /* === Responsive Design === */
        @media (max-width: 1024px) {
            .main-container { grid-template-columns: 250px 1fr; gap: 20px; }
            .movies-grid { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
            .modal-body { padding: 30px; }
        }
        @media (max-width: 768px) {
            .main-container { grid-template-columns: 1fr; }
            .sidebar { position: static; margin-bottom: 20px; }
            .header-container { flex-direction: column; gap: 15px; text-align: center; }
            .movie-detail { grid-template-columns: 1fr; text-align: center; }
        }
        @media (max-width: 480px) {
            .movies-grid { grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; }
            .modal-body { padding: 20px; }
            .logo h1 { font-size: 1.4rem; }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-container">
            <div class="logo">
                <i class="fas fa-film"></i>
                <h1>Movie Discovery App</h1>
            </div>
            <div class="theme-toggle">
                <span>Light</span>
                <label class="switch">
                    <input type="checkbox" id="themeToggle">
                    <span class="slider"></span>
                </label>
                <span>Dark</span>
            </div>
        </div>
    </header>

    <main class="container main-container">
        <aside class="sidebar">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Tìm kiếm phim...">
            </div>
            <div class="filters">
                <h3><i class="fas fa-filter"></i> Lọc theo thể loại</h3>
                <div class="filter-options" id="genreFilters"></div>
            </div>
            <div class="stats">
                <h3><i class="fas fa-chart-bar"></i> Thống kê</h3>
                <p>Tổng số phim: <span id="totalMovies">0</span></p>
                <p>Đang hiển thị: <span id="showingMovies">0</span></p>
            </div>
            <div class="clear-filters" style="margin: 20px 0;">
                <button id="clearFilters" class="btn-clear">
                    <i class="fas fa-times-circle"></i> Xóa bộ lọc
                </button>
            </div>
            <div class="student-info">
                <h3><i class="fas fa-user-graduate"></i> Thông tin sinh viên</h3>
                <p><strong>Họ tên:</strong> Huỳnh Thanh Danh</p>
                <p><strong>MSSV:</strong> 231A010145</p>
                <p><strong>Môn học:</strong> Lập trình Web</p>
                <p><strong>Mã đề:</strong> EG04</p>
            </div>
        </aside>

        <section class="main-content">
            <div class="content-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid var(--border-color);">
                <h2 style="font-size: 1.8rem; color: var(--text-color);">Danh sách phim <span id="filterStatus" style="font-size: 1rem; color: var(--text-secondary); font-weight: normal; margin-left: 10px;"></span></h2>
                <div class="sort-options">
                    <select id="sortSelect" style="padding: 10px 15px; border: 2px solid var(--border-color); border-radius: 8px; background-color: var(--surface-color); color: var(--text-color); font-size: 0.95rem; cursor: pointer;">
                        <option value="default">Sắp xếp mặc định</option>
                        <option value="year-desc">Năm mới nhất</option>
                        <option value="year-asc">Năm cũ nhất</option>
                        <option value="title-asc">Tên A-Z</option>
                        <option value="title-desc">Tên Z-A</option>
                        <option value="rating-desc">Điểm cao nhất</option>
                    </select>
                </div>
            </div>
            <div class="movies-grid" id="moviesGrid">
                <div class="loading" style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: var(--text-secondary); font-size: 1.2rem;">
                    <i class="fas fa-spinner fa-spin"></i> Đang tải dữ liệu...
                </div>
            </div>
            <div class="pagination" id="pagination" style="display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--border-color);"></div>
        </section>
    </main>

    <!-- Modal Chi Tiết Phim -->
    <div class="modal" id="movieModal">
        <div class="modal-content">
            <button class="close-modal" id="closeModal">&times;</button>
            <div class="modal-body" id="modalBody"></div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>© 2026 Movie Discovery App - Đề thi Lập trình Web - EG04</p>
            <p><strong>Sinh viên:</strong> Huỳnh Thanh Danh - <strong>MSSV:</strong> 231A010145</p>
            <p><strong>Ngày thi:</strong> 10.02.2026 - <strong>Thời gian:</strong> 150 phút</p>
            <p><strong>Triển khai:</strong> Toàn bộ code gộp trong 1 file HTML</p>
        </div>
    </footer>

    <!-- Toàn bộ JavaScript được viết trực tiếp trong script tag -->
    <script>
        // ==================== DỮ LIỆU PHIM ====================
        const moviesData = [
            { id: 1, title: "The Dark Knight", year: 2008, genres: ["Hành động", "Tội phạm", "Kịch"], director: "Christopher Nolan", cast: ["Christian Bale", "Heath Ledger", "Aaron Eckhart", "Maggie Gyllenhaal"], description: "Khi Joker, một tên tội phạm nguy hiểm, gieo rắc hỗn loạn và tàn phá lên thành phố Gotham, Người Dơi phải đối mặt với thử thách lớn nhất về thể chất và tinh thần để chống lại kẻ thù này.", rating: 9.0, duration: "152 phút", posterUrl: "https://images.unsplash.com/photo-1635805737707-575885ab0820?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80" },
            { id: 2, title: "Inception", year: 2010, genres: ["Hành động", "Khoa học viễn tưởng", "Giật gân"], director: "Christopher Nolan", cast: ["Leonardo DiCaprio", "Joseph Gordon-Levitt", "Ellen Page", "Tom Hardy"], description: "Một tên trộm đánh cắp bí mật kinh doanh bằng cách xâm nhập vào tiềm thức của mục tiêu. Anh ta được giao nhiệm vụ bất khả thi: trồng một ý tưởng vào tâm trí của một người.", rating: 8.8, duration: "148 phút", posterUrl: "https://images.unsplash.com/photo-1534447677768-be436bb09401?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80" },
            { id: 3, title: "Parasite", year: 2019, genres: ["Hài kịch", "Kinh dị", "Kịch"], director: "Bong Joon Ho", cast: ["Song Kang-ho", "Lee Sun-kyun", "Cho Yeo-jeong", "Choi Woo-shik"], description: "Gia đình Kim cố gắng trở thành người hầu cho gia đình Park giàu có, nhưng sự thao túng và lừa dối của họ dẫn đến những hậu quả bất ngờ.", rating: 8.6, duration: "132 phút", posterUrl: "https://images.unsplash.com/photo-1489599809516-9827b6d1cf13?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80" },
            { id: 4, title: "The Shawshank Redemption", year: 1994, genres: ["Kịch"], director: "Frank Darabont", cast: ["Tim Robbins", "Morgan Freeman", "Bob Gunton", "William Sadler"], description: "Hai tù nhân xây dựng tình bạn qua nhiều năm, tìm thấy sự an ủi và cuối cùng là cứu rỗi thông qua việc thực hiện các hành vi tốt.", rating: 9.3, duration: "142 phút", posterUrl: "https://images.unsplash.com/photo-1551698618-1dfe5d97d256?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80" },
            { id: 5, title: "Avengers: Endgame", year: 2019, genres: ["Hành động", "Phiêu lưu", "Khoa học viễn tưởng"], director: "Anthony Russo, Joe Russo", cast: ["Robert Downey Jr.", "Chris Evans", "Mark Ruffalo", "Chris Hemsworth"], description: "Sau sự tàn phá của Thanos, các Avengers còn lại phải tìm cách đảo ngược hành động của hắn và khôi phục lại trật tự cho vũ trụ.", rating: 8.4, duration: "181 phút", posterUrl: "https://images.unsplash.com/photo-1635805737707-575885ab0820?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80" },
            { id: 6, title: "Spirited Away", year: 2001, genres: ["Hoạt hình", "Phiêu lưu", "Gia đình"], director: "Hayao Miyazaki", cast: ["Rumi Hiiragi", "Miyu Irino", "Mari Natsuki", "Takashi Naito"], description: "Trong hành trình chuyển nhà, gia đình Chihiro dừng chân tại một công viên giải trí bí ẩn, nơi bố mẹ cô biến thành lợn và cô phải làm việc để giải thoát họ.", rating: 8.6, duration: "125 phút", posterUrl: "https://images.unsplash.com/photo-1578662996442-48f60103fc96?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80" },
            { id: 7, title: "Interstellar", year: 2014, genres: ["Khoa học viễn tưởng", "Phiêu lưu", "Kịch"], director: "Christopher Nolan", cast: ["Matthew McConaughey", "Anne Hathaway", "Jessica Chastain", "Michael Caine"], description: "Một nhóm nhà thám hiểm đi qua lỗ sâu trong không gian để tìm kiếm một ngôi nhà mới cho nhân loại.", rating: 8.6, duration: "169 phút", posterUrl: "https://images.unsplash.com/photo-1446776653964-20c1d3a81b06?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80" },
            { id: 8, title: "La La Land", year: 2016, genres: ["Hài kịch", "Kịch", "Âm nhạc"], director: "Damien Chazelle", cast: ["Ryan Gosling", "Emma Stone", "John Legend", "Rosemarie DeWitt"], description: "Trong khi theo đuổi ước mơ của mình ở Los Angeles, một nghệ sĩ piano và một nữ diễn viên đầy tham vọng phải lòng nhau.", rating: 8.0, duration: "128 phút", posterUrl: "https://images.unsplash.com/photo-1489599809516-9827b6d1cf13?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80" }
        ];
        // ==================== BIẾN TOÀN CỤC ====================
        let filteredMovies = [...moviesData];
        let selectedGenres = [];
        let searchTerm = "";
        let debounceTimer;
        let currentPage = 1;
        const moviesPerPage = 6;
        let sortBy = "default";
        // ==================== DOM ELEMENTS ====================
        const moviesGrid = document.getElementById('moviesGrid');
        const genreFilters = document.getElementById('genreFilters');
        const searchInput = document.getElementById('searchInput');
        const totalMoviesElement = document.getElementById('totalMovies');
        const showingMoviesElement = document.getElementById('showingMovies');
        const movieModal = document.getElementById('movieModal');
        const closeModal = document.getElementById('closeModal');
        const modalBody = document.getElementById('modalBody');
        const themeToggle = document.getElementById('themeToggle');
        const clearFiltersBtn = document.getElementById('clearFilters');
        const sortSelect = document.getElementById('sortSelect');
        const pagination = document.getElementById('pagination');
        const filterStatus = document.getElementById('filterStatus');
        // ==================== KHỞI TẠO ỨNG DỤNG ====================
        function initApp() {
            renderMovies();
            setupGenreFilters();
            setupEventListeners();
            loadThemePreference();
            updateStats();
            updateFilterStatus();
            renderPagination();
        }
        // ==================== CÁC HÀM CHÍNH ====================
        function renderMovies() {
            moviesGrid.innerHTML = '';
            if (filteredMovies.length === 0) {
                moviesGrid.innerHTML = `
                    <div class="no-results" style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: var(--text-secondary);">
                        <i class="fas fa-film fa-3x" style="margin-bottom: 20px; color: var(--primary-color); opacity: 0.5;"></i>
                        <h3 style="margin-bottom: 10px; color: var(--text-color);">Không tìm thấy phim nào</h3>
                        <p>Thử thay đổi bộ lọc hoặc từ khóa tìm kiếm</p>
                    </div>`;
                return;
            }
            const sortedMovies = sortMovies([...filteredMovies]);
            const startIndex = (currentPage - 1) * moviesPerPage;
            const endIndex = startIndex + moviesPerPage;
            const paginatedMovies = sortedMovies.slice(startIndex, endIndex);
            paginatedMovies.forEach(movie => {
                const movieCard = document.createElement('div');
                movieCard.className = 'movie-card';
                movieCard.innerHTML = `
                    <div class="movie-rating"><i class="fas fa-star"></i> ${movie.rating}</div>
                    <img src="${movie.posterUrl}" alt="${movie.title}" class="movie-poster">
                    <div class="movie-info">
                        <h3 class="movie-title">${movie.title}</h3>
                        <p class="movie-year" style="color: var(--text-secondary); font-size: 0.95rem; margin-bottom: 10px;">
                            <i class="far fa-calendar-alt"></i> ${movie.year} • <i class="far fa-clock"></i> ${movie.duration}
                        </p>
                        <div class="movie-genres">
                            ${movie.genres.map(genre => `<span class="genre-tag">${genre}</span>`).join('')}
                        </div>
                    </div>`;
                movieCard.addEventListener('click', () => openMovieModal(movie));
                moviesGrid.appendChild(movieCard);
            });
        }
        function sortMovies(movies) {
            switch(sortBy) {
                case 'year-desc': return movies.sort((a, b) => b.year - a.year);
                case 'year-asc': return movies.sort((a, b) => a.year - b.year);
                case 'title-asc': return movies.sort((a, b) => a.title.localeCompare(b.title));
                case 'title-desc': return movies.sort((a, b) => b.title.localeCompare(a.title));
                case 'rating-desc': return movies.sort((a, b) => b.rating - a.rating);
                default: return movies;
            }
        }
        function setupGenreFilters() {
            const allGenres = moviesData.flatMap(movie => movie.genres);
            const uniqueGenres = [...new Set(allGenres)];
            const genreCounts = {};
            uniqueGenres.forEach(genre => {
                genreCounts[genre] = moviesData.filter(movie => movie.genres.includes(genre)).length;
            });
            uniqueGenres.sort((a, b) => genreCounts[b] - genreCounts[a]);
            genreFilters.innerHTML = uniqueGenres.map(genre => `
                <div class="genre-option">
                    <input type="checkbox" id="genre-${genre.replace(/\s+/g, '-')}" value="${genre}">
                    <label for="genre-${genre.replace(/\s+/g, '-')}">${genre}</label>
                    <span class="genre-count">${genreCounts[genre]}</span>
                </div>`).join('');
            document.querySelectorAll('.genre-option input').forEach(checkbox => {
                checkbox.addEventListener('change', handleGenreFilter);
            });
        }
        function handleGenreFilter() {
            selectedGenres = Array.from(document.querySelectorAll('.genre-option input:checked')).map(checkbox => checkbox.value);
            applyFilters(); currentPage = 1;
        }
        function handleSearch() {
            searchTerm = searchInput.value.toLowerCase().trim();
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => { applyFilters(); currentPage = 1; }, 400);
        }
        function applyFilters() {
            filteredMovies = moviesData.filter(movie => {
                const genreMatch = selectedGenres.length === 0 || selectedGenres.some(genre => movie.genres.includes(genre));
                const searchMatch = searchTerm === '' || movie.title.toLowerCase().includes(searchTerm) || movie.director.toLowerCase().includes(searchTerm) || movie.cast.some(actor => actor.toLowerCase().includes(searchTerm)) || movie.description.toLowerCase().includes(searchTerm);
                return genreMatch && searchMatch;
            });
            renderMovies(); updateStats(); updateFilterStatus(); renderPagination();
        }
        function updateStats() {
            totalMoviesElement.textContent = moviesData.length;
            showingMoviesElement.textContent = filteredMovies.length;
        }
        function updateFilterStatus() {
            let status = "";
            if (selectedGenres.length > 0) status += ` (${selectedGenres.length} thể loại)`;
            if (searchTerm) status += ` • Tìm: "${searchTerm}"`;
            filterStatus.textContent = status;
        }
        function clearAllFilters() {
            selectedGenres = []; searchInput.value = ""; searchTerm = "";
            sortSelect.value = "default"; sortBy = "default";
            document.querySelectorAll('.genre-option input').forEach(checkbox => checkbox.checked = false);
            applyFilters(); currentPage = 1;
        }
        function renderPagination() {
            const totalPages = Math.ceil(filteredMovies.length / moviesPerPage);
            if (totalPages <= 1) { pagination.innerHTML = ''; return; }
            let paginationHTML = `<button class="page-btn prev-btn" ${currentPage === 1 ? 'disabled' : ''} style="padding: 8px 15px; background-color: var(--surface-color); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-color); cursor: pointer; transition: var(--transition);"><i class="fas fa-chevron-left"></i> Trước</button>`;
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                    paginationHTML += `<button class="page-btn ${i === currentPage ? 'active' : ''}" data-page="${i}" style="padding: 8px 15px; background-color: ${i === currentPage ? 'var(--primary-color)' : 'var(--surface-color)'}; color: ${i === currentPage ? 'white' : 'var(--text-color)'}; border: 1px solid var(${i === currentPage ? '--primary-color' : '--border-color'}); border-radius: 6px; cursor: pointer;">${i}</button>`;
                } else if (i === currentPage - 2 || i === currentPage + 2) {
                    paginationHTML += `<span style="padding: 8px 12px; color: var(--text-secondary);">...</span>`;
                }
            }
            paginationHTML += `<button class="page-btn next-btn" ${currentPage === totalPages ? 'disabled' : ''} style="padding: 8px 15px; background-color: var(--surface-color); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-color); cursor: pointer; transition: var(--transition);">Sau <i class="fas fa-chevron-right"></i></button>`;
            pagination.innerHTML = paginationHTML;
            // Thêm sự kiện cho phân trang
            document.querySelectorAll('.page-btn').forEach(btn => {
                if (!btn.classList.contains('prev-btn') && !btn.classList.contains('next-btn')) {
                    btn.addEventListener('click', () => {
                        currentPage = parseInt(btn.dataset.page);
                        renderMovies(); renderPagination(); window.scrollTo({ top: 0, behavior: 'smooth' });
                    });
                }
            });
            document.querySelector('.prev-btn')?.addEventListener('click', () => { if (currentPage > 1) { currentPage--; renderMovies(); renderPagination(); window.scrollTo({ top: 0, behavior: 'smooth' }); } });
            document.querySelector('.next-btn')?.addEventListener('click', () => { const totalPages = Math.ceil(filteredMovies.length / moviesPerPage); if (currentPage < totalPages) { currentPage++; renderMovies(); renderPagination(); window.scrollTo({ top: 0, behavior: 'smooth' }); } });
        }
        function openMovieModal(movie) {
            modalBody.innerHTML = `
                <div class="movie-detail">
                    <img src="${movie.posterUrl}" alt="${movie.title}" class="modal-poster" style="width: 100%; border-radius: 8px; box-shadow: var(--shadow);">
                    <div class="movie-detail-info">
                        <h2 style="font-size: 2rem; margin-bottom: 10px; color: var(--primary-color);">${movie.title} (${movie.year})</h2>
                        <div class="movie-meta" style="display: flex; gap: 20px; margin-bottom: 20px; color: var(--text-secondary);">
                            <span><i class="fas fa-star"></i> ${movie.rating}/10</span>
                            <span><i class="fas fa-clock"></i> ${movie.duration}</span>
                            <span><i class="fas fa-video"></i> ${movie.director}</span>
                        </div>
                        <div class="genres-list" style="margin-bottom: 15px;">
                            <h4 style="color: var(--primary-color); margin-bottom: 8px;"><i class="fas fa-tags"></i> Thể loại</h4>
                            ${movie.genres.map(genre => `<span class="genre-tag">${genre}</span>`).join('')}
                        </div>
                        <p class="movie-description" style="margin-bottom: 20px; line-height: 1.8;">${movie.description}</p>
                        <div class="director" style="margin-bottom: 15px;">
                            <h4 style="color: var(--primary-color); margin-bottom: 8px;"><i class="fas fa-video"></i> Đạo diễn</h4>
                            <p>${movie.director}</p>
                        </div>
                        <div class="cast-list">
                            <h4 style="color: var(--primary-color); margin-bottom: 8px;"><i class="fas fa-users"></i> Diễn viên chính</h4>
                            <p>${movie.cast.join(', ')}</p>
                        </div>
                    </div>
                </div>`;
            movieModal.style.display = 'block'; document.body.style.overflow = 'hidden';
        }
        function closeMovieModal() { movieModal.style.display = 'none'; document.body.style.overflow = 'auto'; }
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }
        function loadThemePreference() {
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode'); themeToggle.checked = true;
            }
        }
        // ==================== THIẾT LẬP SỰ KIỆN ====================
        function setupEventListeners() {
            searchInput.addEventListener('input', handleSearch);
            closeModal.addEventListener('click', closeMovieModal);
            window.addEventListener('click', (e) => { if (e.target === movieModal) closeMovieModal(); });
            document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && movieModal.style.display === 'block') closeMovieModal(); });
            themeToggle.addEventListener('change', toggleTheme);
            clearFiltersBtn.addEventListener('click', clearAllFilters);
            sortSelect.addEventListener('change', (e) => { sortBy = e.target.value; applyFilters(); currentPage = 1; });
        }
        // ==================== CHẠY ỨNG DỤNG ====================
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>